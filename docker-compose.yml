version: '3.8'

services:
  # Base de datos MySQL para players
  players-db:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: players
      MYSQL_USER: players
      MYSQL_PASSWORD: players123
    ports:
      - "3307:3306"
    volumes:
      - players_data:/var/lib/mysql
    networks:
      - basketball_net

  # SQL Server para otros servicios
  sqlserver:
    image: mcr.microsoft.com/mssql/server:2022-latest
    environment:
      SA_PASSWORD: 'D3saweb.2025$'
      ACCEPT_EULA: 'Y'
    ports:
      - "1433:1433"
    volumes:
      - sqlserver_data:/var/opt/mssql
    networks:
      - basketball_net

  # Microservicio de autenticaci√≥n
  auth-service:
    build: ./MicroservicioAuth
    ports:
      - "5001:8080"
    depends_on:
      - sqlserver
    environment:
      - ConnectionStrings__DefaultConnection=Server=sqlserver;Database=desaweb;User Id=sa;Password=D3saweb.2025$;TrustServerCertificate=true;
    networks:
      - basketball_net

  # Microservicio de jugadores (PHP)
  players-service:
    build: ./MicroservicioPlayers
    ports:
      - "8082:8082"
    depends_on:
      - players-db
    environment:
      - DB_HOST=players-db
      - DB_DATABASE=players
      - DB_USERNAME=players
      - DB_PASSWORD=players123
      - FRONT_ORIGIN=http://localhost:4200
    networks:
      - basketball_net

  # Microservicio de equipos
  teams-service:
    build: ./MicroservicioTeams
    ports:
      - "5003:8080"
    depends_on:
      - sqlserver
      - auth-service
    environment:
      - ConnectionStrings__DefaultConnection=Server=sqlserver;Database=desaweb;User Id=sa;Password=D3saweb.2025$;TrustServerCertificate=true;
      - AuthService__BaseUrl=http://auth-service:8080
    networks:
      - basketball_net

  # Microservicio de reportes
  reports-service:
    build: ./MicroservicioReportes
    ports:
      - "5004:8080"
    depends_on:
      - sqlserver
      - auth-service
    environment:
      - ConnectionStrings__DefaultConnection=Server=sqlserver;Database=desaweb;User Id=sa;Password=D3saweb.2025$;TrustServerCertificate=true;
      - AuthService__BaseUrl=http://auth-service:8080
    networks:
      - basketball_net

  # Frontend Angular
  frontend:
    build: ./Frontend
    ports:
      - "4200:80"
    depends_on:
      - auth-service
      - players-service
      - teams-service
      - reports-service
    networks:
      - basketball_net

volumes:
  players_data:
  sqlserver_data:

networks:
  basketball_net:
    driver: bridge